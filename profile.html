<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perkenalan Kelas - Kelas Kami</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold primary-color">Kelas Kami</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Beranda</a>
                        <a href="gallery.html" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Galeri</a>
                        <a href="minigame.html" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Minigame</a>
                        <a href="profile.html" class="text-gray-900 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Perkenalan</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userWelcome" class="text-sm text-gray-700 hidden">Selamat datang, <span id="userName"></span></span>
                    <button id="loginBtn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">Login</button>
                    <button id="logoutBtn" class="btn-secondary px-4 py-2 rounded-lg text-sm font-medium hidden">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Perkenalan Kelas</h2>
            <p class="text-xl opacity-90">Kenali lebih dekat setiap anggota kelas kita</p>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="py-8 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                <!-- Search Box -->
                <div class="relative flex-1 max-w-md">
                    <input type="text" id="searchInput" placeholder="Cari siswa berdasarkan nama..." 
                           class="search-box w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <svg class="absolute left-3 top-3.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                
                <!-- Admin Controls -->
                <div id="adminControls" class="hidden flex items-center space-x-3">
                    <button onclick="exportData()" class="btn-secondary px-4 py-2 rounded-lg text-sm font-medium">
                        Export Data
                    </button>
                    <button onclick="showAddStudentModal()" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                        Tambah Siswa
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Students Grid -->
    <section class="py-8 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Stats -->
            <div class="mb-6 text-center">
                <p class="text-gray-600">Menampilkan <span id="resultCount">35</span> siswa</p>
            </div>
            
            <!-- Students Grid -->
            <div id="studentsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Student cards will be populated by JavaScript -->
            </div>
            
            <!-- No Results -->
            <div id="noResults" class="hidden text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Tidak ada siswa ditemukan</h3>
                <p class="text-gray-500">Coba ubah kata pencarian</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-400">&copy; 2024 Kelas Kami. Dibuat dengan ❤️ untuk komunitas belajar.</p>
        </div>
    </footer>

    <!-- Edit Profile Modal -->
    <div id="editModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4" style="backdrop-filter: blur(10px); background-color: rgba(0, 0, 0, 0.5);">
        <div class="bg-white p-8 max-w-md w-full mx-4 rounded-2xl shadow-2xl max-h-96 overflow-y-auto">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Edit Profil</h3>
                <p class="text-gray-600">Perbarui informasi profil Anda</p>
            </div>
            
            <form id="editForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="editNama" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Hobi</label>
                    <input type="text" id="editHobi" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Contoh: Membaca, Olahraga, Musik">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Motto Hidup</label>
                    <textarea id="editMotto" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Tuliskan motto hidup Anda"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi Diri</label>
                    <textarea id="editDeskripsi" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ceritakan tentang diri Anda"></textarea>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-400 transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-lg font-medium">
                        Simpan
                    </button>
                </div>
            </form>
            
            <button onclick="closeEditModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4" style="backdrop-filter: blur(10px); background-color: rgba(0, 0, 0, 0.5);">
        <div class="bg-white p-8 max-w-md w-full mx-4 rounded-2xl shadow-2xl">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Login untuk Melihat Profil</h3>
                <p class="text-gray-600">Masukkan username dan password Anda</p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password" required>
                </div>
                
                <div id="loginError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
                    <p class="text-sm">Username atau password salah!</p>
                </div>
                
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-medium">
                    Login
                </button>
            </form>
            
            <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Profile-specific JavaScript
        let searchQuery = '';
        let currentEditUser = null;
        
        // Student profiles data (extended from users database)
        let studentProfiles = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            checkSession();
            
            // Initialize student profiles
            initializeStudentProfiles();
            
            // Display students
            displayStudents(studentProfiles);
            
            // Setup search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                searchQuery = e.target.value.toLowerCase();
                filterAndDisplayStudents();
            });
            
            // Setup edit form
            document.getElementById('editForm').addEventListener('submit', handleEditSubmit);
            
            // Show admin controls if admin
            if (currentUser && currentUser.role === 'admin') {
                document.getElementById('adminControls').classList.remove('hidden');
            }
        });
        
        // Initialize student profiles with extended data
        function initializeStudentProfiles() {
            studentProfiles = usersDatabase.map(user => ({
                ...user,
                profile: {
                    foto: `https://picsum.photos/seed/${user.user}/200/200.jpg`,
                    hobi: getRandomHobi(),
                    motto: getRandomMotto(),
                    deskripsi: getRandomDeskripsi(user.nama)
                }
            }));
        }
        
        // Get random hobbies
        function getRandomHobi() {
            const hobbies = [
                'Membaca buku, Menulis, Mendengarkan musik',
                'Olahraga, Sepak bola, Basket',
                'Melukis, Menggambar, Seni',
                'Bermain musik, Gitar, Piano',
                'Fotografi, Videografi, Editing',
                'Memasak, Baking, Mencoba resep baru',
                'Berkebun, Merawat tanaman, Alam',
                'Coding, Programming, Teknologi',
                'Belajar bahasa asing, Travelling, Budaya',
                'Menari, Menyanyi, Teater'
            ];
            return hobbies[Math.floor(Math.random() * hobbies.length)];
        }
        
        // Get random motto
        function getRandomMotto() {
            const mottos = [
                'Belajar dari kegagalan adalah kunci kesuksesan',
                'Dream big, work hard, stay focused',
                'Setiap hari adalah kesempatan untuk belajar sesuatu baru',
                'Success is not final, failure is not fatal',
                'The only way to do great work is to love what you do',
                'Never stop learning, because life never stops teaching',
                'Be the change you wish to see in the world',
                'Stay hungry, stay foolish',
                'Believe you can and you\'re halfway there',
                'Education is the most powerful weapon'
            ];
            return mottos[Math.floor(Math.random() * mottos.length)];
        }
        
        // Get random description
        function getRandomDeskripsi(nama) {
            const descriptions = [
                `Halo! Saya ${nama}, senang belajar dan berkembang bersama teman-teman di kelas ini.`,
                `Saya ${nama}, selalu bersemangat mencoba hal baru dan menantang diri sendiri.`,
                `Perkenalkan, saya ${nama}. Saya suka membantu teman-teman dan belajar dari pengalaman.`,
                `Halo semua! Saya ${nama}, siap berkontribusi positif untuk kelas kita.`,
                `Saya ${nama}, percaya bahwa kerja sama tim adalah kunci kesuksesan.`
            ];
            return descriptions[Math.floor(Math.random() * descriptions.length)];
        }
        
        // Display students
        function displayStudents(students) {
            const studentsGrid = document.getElementById('studentsGrid');
            const noResults = document.getElementById('noResults');
            const resultCount = document.getElementById('resultCount');
            
            studentsGrid.innerHTML = '';
            
            if (students.length === 0) {
                noResults.classList.remove('hidden');
                resultCount.textContent = '0';
                return;
            }
            
            noResults.classList.add('hidden');
            resultCount.textContent = students.length;
            
            students.forEach(student => {
                const studentCard = createStudentCard(student);
                studentsGrid.appendChild(studentCard);
            });
        }
        
        // Create student card
        function createStudentCard(student) {
            const card = document.createElement('div');
            card.className = 'profile-card bg-white rounded-lg shadow-md overflow-hidden';
            
            const canEdit = currentUser && (currentUser.role === 'admin' || 
                          (currentUser.role === 'member' && currentUser.username === student.user));
            
            card.innerHTML = `
                <div class="p-6 text-center">
                    <img src="${student.profile.foto}" alt="${student.nama}" 
                         class="w-24 h-24 rounded-full mx-auto mb-4 object-cover border-4 border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900 mb-1">${student.nama}</h3>
                    <p class="text-sm text-gray-600 mb-3">@${student.user}</p>
                    
                    <div class="text-left space-y-2 mb-4">
                        <div>
                            <span class="text-xs font-medium text-gray-500 uppercase">Hobi</span>
                            <p class="text-sm text-gray-700">${student.profile.hobi}</p>
                        </div>
                        <div>
                            <span class="text-xs font-medium text-gray-500 uppercase">Motto</span>
                            <p class="text-sm text-gray-700 italic">"${student.profile.motto}"</p>
                        </div>
                        <div>
                            <span class="text-xs font-medium text-gray-500 uppercase">Deskripsi</span>
                            <p class="text-sm text-gray-700">${student.profile.deskripsi}</p>
                        </div>
                    </div>
                    
                    ${canEdit ? `
                        <button onclick="editProfile('${student.user}')" 
                                class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium w-full">
                            Edit Profil
                        </button>
                    ` : `
                        <div class="bg-gray-100 text-gray-500 px-4 py-2 rounded-lg text-sm font-medium w-full">
                            Lihat Mode
                        </div>
                    `}
                </div>
            `;
            
            return card;
        }
        
        // Filter and display students
        function filterAndDisplayStudents() {
            let filteredStudents = studentProfiles;
            
            // Filter by search query
            if (searchQuery) {
                filteredStudents = filteredStudents.filter(student => 
                    student.nama.toLowerCase().includes(searchQuery) ||
                    student.user.toLowerCase().includes(searchQuery) ||
                    student.profile.hobi.toLowerCase().includes(searchQuery)
                );
            }
            
            displayStudents(filteredStudents);
        }
        
        // Edit profile
        function editProfile(username) {
            if (!currentUser) {
                showNotification('Silakan login terlebih dahulu!', 'warning');
                showLoginModal();
                return;
            }
            
            const student = studentProfiles.find(s => s.user === username);
            if (!student) return;
            
            // Check permission
            const canEdit = currentUser.role === 'admin' || 
                          (currentUser.role === 'member' && currentUser.username === username);
            
            if (!canEdit) {
                showNotification('Anda tidak memiliki izin untuk mengedit profil ini!', 'error');
                return;
            }
            
            currentEditUser = username;
            
            // Populate form
            document.getElementById('editNama').value = student.nama;
            document.getElementById('editHobi').value = student.profile.hobi;
            document.getElementById('editMotto').value = student.profile.motto;
            document.getElementById('editDeskripsi').value = student.profile.deskripsi;
            
            // Show modal
            document.getElementById('editModal').classList.remove('hidden');
        }
        
        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditUser = null;
        }
        
        // Handle edit form submit
        function handleEditSubmit(e) {
            e.preventDefault();
            
            if (!currentEditUser) return;
            
            const studentIndex = studentProfiles.findIndex(s => s.user === currentEditUser);
            if (studentIndex === -1) return;
            
            // Update student data
            studentProfiles[studentIndex].nama = document.getElementById('editNama').value;
            studentProfiles[studentIndex].profile.hobi = document.getElementById('editHobi').value;
            studentProfiles[studentIndex].profile.motto = document.getElementById('editMotto').value;
            studentProfiles[studentIndex].profile.deskripsi = document.getElementById('editDeskripsi').value;
            
            // Update users database
            const userIndex = usersDatabase.findIndex(u => u.user === currentEditUser);
            if (userIndex !== -1) {
                usersDatabase[userIndex].nama = document.getElementById('editNama').value;
            }
            
            // Save to localStorage
            localStorage.setItem('studentProfiles', JSON.stringify(studentProfiles));
            
            showNotification('Profil berhasil diperbarui!', 'success');
            
            // Close modal and refresh display
            closeEditModal();
            filterAndDisplayStudents();
        }
        
        // Export data (admin only)
        function exportData() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('Hanya admin yang dapat mengekspor data!', 'error');
                return;
            }
            
            const data = {
                students: studentProfiles,
                exported: new Date().toISOString(),
                total: studentProfiles.length
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data-siswa-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data berhasil diekspor!', 'success');
        }
        
        // Show add student modal (admin only)
        function showAddStudentModal() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('Hanya admin yang dapat menambah siswa!', 'error');
                return;
            }
            
            showNotification('Fitur tambah siswa akan segera tersedia!', 'info');
        }
        
        // Load profiles from localStorage if available
        function loadSavedProfiles() {
            const saved = localStorage.getItem('studentProfiles');
            if (saved) {
                const savedData = JSON.parse(saved);
                // Merge with existing data
                savedData.forEach(savedStudent => {
                    const index = studentProfiles.findIndex(s => s.user === savedStudent.user);
                    if (index !== -1) {
                        studentProfiles[index] = savedStudent;
                    }
                });
            }
        }
        
        // Load saved profiles on initialization
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedProfiles();
        });
        
        // Make functions global
        window.editProfile = editProfile;
        window.closeEditModal = closeEditModal;
        window.exportData = exportData;
        window.showAddStudentModal = showAddStudentModal;
    </script>
</body>
</html>